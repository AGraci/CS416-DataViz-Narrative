<!DOCTYPE html>
<html>
<header>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
</header>
<body onload='init()'>

  <h1>CS416 Data Viz: Narrative</h1>
  <div id="slide"></div>

<script>
  async function init() {
      // set the dimensions and margins of the graph
      var margin = {top: 10, right: 30, bottom: 30, left: 60},
	  width = 460 - margin.left - margin.right,
	  height = 400 - margin.top - margin.bottom;
      
      // append the svg object to the body of the page
      var svg = d3.select("#slide")
	  .append("svg")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	  .append("g")
          .attr("style", "outline: thin solid red;")
	  .attr("transform",
		"translate(" + margin.left + "," + margin.top + ")");
      
      //Read the data
      var raw_data = await d3.csv("https://raw.githubusercontent.com/AGraci/agraci.github.io/main/cleaned_data_2019.csv");
      var data = raw_data.filter(d => d.expenditure != null && d.expectancy != null && d.expenditure != '' && d.expectancy != '');
      var data = data.filter(d => d.income != null && d.income != '');
      const xdata = data.map(d => d.expenditure);
      const ydata = data.map(d => d.expectancy);
      const xextent = d3.extent(xdata)
      const yextent = d3.extent(ydata)
      console.log(xextent)
      console.log(yextent)
      
      // Add X axis
      var x = d3.scaleLinear()
	  .domain([0, xextent[0]])
	  .range([ 0, width ]);
      svg.append("g")
	  .attr("transform", "translate(0," + height + ")")
	  .call(d3.axisBottom(x));
      
      // Add Y axis
      var y = d3.scaleLinear()
	  .domain([yextent[0], yextent[1]])
	  .range([ height, 0]);
      svg.append("g")
	  .call(d3.axisLeft(y));

      // Add color scale
      const incomes = data.map(d => d.income);
      console.log(d3.extent(incomes))
      console.log(incomes)
      const color = d3.scaleOrdinal()
	    .domain(incomes)
	    .range(d3.schemeSet1)
      //["gold", "blue", "green", "yellow", "black", "grey", "darkgreen", "pink", "brown", "slateblue", "grey1", "orange"])
      //const color = d3.scaleSequential()
//	    .domain(d3.extent(incomes))//
//	    .interpolator(d3.schemeSet1);
      
      // Add dots
      svg.append('g')
	  .selectAll("dot")
	  .data(data)
	  .enter()
	  .append("circle")
          .attr("id", "circleBasicTooltip")
	  .attr("cx", function (d) { return x(d.expenditure); } )
	  .attr("cy", function (d) { return y(d.expectancy); } )
	  .attr("r", 1.5)
	  .attr("fill", function (d) { return color(d.income); } )

      // create a tooltip
      var tooltip = d3.select("#slide")
	  .append("div")
	  .style("position", "absolute")
	  .style("visibility", "hidden")
	  .text("I'm a circle!");

      //
      d3.select("#circleBasicTooltip")
	  .on("mouseover", function(){return tooltip.style("visibility", "visible");})
	  .on("mousemove", function(){return tooltip.style("top", (event.pageY-800)+"px").style("left",(event.pageX-800)+"px");})
	  .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
  }
/*

var raw_data = await d3.csv("https://raw.githubusercontent.com/AGraci/agraci.github.io/main/cleaned_data_2019.csv");
var data = raw_data.filter(d => d.expenditure != null && d.expectancy != null && d.expenditure != '' && d.expectancy != '');    
const xdata = data.map(d => d.expenditure);
const ydata = data.map(d => d.expectancy);    
//console.log(data);

var margin = 50;
var width = 400;
var height = 400;
var tick_values = [10,20,50,100];
var xdomain = [0, d3.extent(xdata)[0]]
var ydomain = [d3.extent(ydata)[0], d3.extent(ydata)[1]]
console.log(xdomain)
console.log(ydomain)
var xrange = [0,width]
var yrange = [height,0]
var cx = d3.scaleLinear().domain(xdomain).range(xrange);
var cy = d3.scaleLinear().domain(ydomain).range(yrange);
d3.select('svg')
.append("g").attr("transform","translate("+margin+","+margin+")")
.selectAll('dot').data(data).enter().append('circle')
.attr("cx", function (d) { return cx(d.expenditure); })
.attr("cy", function (d) { return cy(d.expectancy); })
.attr("r", function (d) { return 2; });

d3.select('svg')
	.append("g").attr("transform","translate("+(margin)+","+(margin)+")")
.call(d3.axisLeft(cy));

d3.select('svg')
.append("g").attr("transform","translate("+(margin)+","+(height+margin)+")")
.call(d3.axisBottom(cx));
}
*/
  </script>
</body>
</html>
