<!DOCTYPE html>
<html>
<header>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
</header>
<body onload='init_imr()'>

  <h1>CS416 Data Viz: Narrative</h1>
  <button onclick='init_exp()'>1</button>
  <button onclick='init_imr()'>2</button>
  <button onclick='init_mat()'>3</button>
  <div id="slide"></div>

<script>
  async function init_exp() {
      // Clear old scenes
      d3.selectAll('svg').remove();
      
      // set the dimensions and margins of the graph
      var margin = {top: 10, right: 30, bottom: 30, left: 60},
	  width = 460 - margin.left - margin.right,
	  height = 400 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg = d3.select("#slide")
	  .append("svg")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	  .append("g")
          .attr("style", "outline: thin solid red;")
	  .attr("transform",
		"translate(" + margin.left + "," + margin.top + ")");
      
      //Read the data
      var raw_data = await d3.csv("https://raw.githubusercontent.com/AGraci/agraci.github.io/main/cleaned_data_2019.csv");
      var data = raw_data.filter(d => d.expenditure != null && d.expectancy != null && d.expenditure != '' && d.expectancy != '');
      var data = data.filter(d => d.income != null && d.income != '');
      const xdata = data.map(d => d.expenditure);
      const ydata = data.map(d => d.expectancy);
      const xextent = d3.extent(xdata)
      const yextent = d3.extent(ydata)
      console.log(xextent)
      console.log(yextent)
      
      // Add X axis
      var x = d3.scaleLinear()
	  .domain([0, Math.max(...xdata)])
	  .range([ 0, width ]);
      svg.append("g")
	  .attr("transform", "translate(0," + height + ")")
	  .call(d3.axisBottom(x));
      
      // Add Y axis
      var y = d3.scaleLinear()
	  .domain([Math.min(...ydata), Math.max(...ydata)])
	  .range([ height, 0]);
      svg.append("g")
	  .call(d3.axisLeft(y));

      // Add color scale
      const incomes = data.map(d => d.income);
      const color = d3.scaleOrdinal()
	    .domain(incomes)
	    .range(d3.schemeSet1)

      // Define the div for the tooltip
      var div = d3.select("body").append("div")	
	  .attr("class", "tooltip")				
	  .style("opacity", 0);
      
      // Add dots
      svg.append('g')
	  .selectAll("dot")
	  .data(data)
	  .enter()
	  .append("circle")
	  .attr("cx", function (d) { return x(d.expenditure); } )
	  .attr("cy", function (d) { return y(d.expectancy); } )
	  .attr("r", 1.5)
	  .attr("fill", function (d) { return color(d.income); } )
	  .on("mouseover", function(e,d) {
	      console.log(d)
              div.transition()		
                  .duration(200)		
                  .style("opacity", .9);		
              div.html(d.name + "<br/>"  + d.expenditure)	
                  .style("left", (200) + "px")		
                  .style("top", (200) + "px");	
          })					
          .on("mouseout", function(e,d) {		
              div.transition()		
                  .duration(500)		
                  .style("opacity", 0);	
	  });
  };
  async function init_imr() {
      // Clear old scenes
      d3.selectAll('svg').remove();
      
      // set the dimensions and margins of the graph
      var margin = {top: 10, right: 30, bottom: 30, left: 60},
	  width = 460 - margin.left - margin.right,
	  height = 400 - margin.top - margin.bottom;
      
      // append the svg object to the body of the page
      var svg = d3.select("#slide")
	  .append("svg")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	  .append("g")
          .attr("style", "outline: thin solid red;")
	  .attr("transform",
		"translate(" + margin.left + "," + margin.top + ")");
      
      //Read the data
      var raw_data = await d3.csv("https://raw.githubusercontent.com/AGraci/agraci.github.io/main/cleaned_data_2019.csv");
      var data = raw_data.filter(d => d.expenditure != null && d.mr_infant != null && d.expenditure != '' && d.mr_infant != '');
      var data = data.filter(d => d.income != null && d.income != '');
      const xdata = data.map(d => d.expenditure);
      const ydata = data.map(d => d.mr_infant);
      const xextent = d3.extent(xdata)
      const yextent = [Math.min(...ydata), Math.max(...ydata)]
      console.log(xextent)
      console.log(yextent)
      console.log(ydata)
      
      // Add X axis
      var x = d3.scaleLinear()
	  .domain([0, 12000])
	  .range([ 0, width ]);
      svg.append("g")
	  .attr("transform", "translate(0," + height + ")")
	  .call(d3.axisBottom(x));
      
      // Add Y axis
      var y = d3.scaleLinear()
	  .domain([0, Math.max(...ydata)])
	  .range([ height, 0]);
      svg.append("g")
	  .call(d3.axisLeft(y));

      // Add color scale
      const incomes = data.map(d => d.income);
      console.log(d3.extent(incomes))
      console.log(incomes)
      const color = d3.scaleOrdinal()
	    .domain(incomes)
	    .range(d3.schemeSet1)

      // Define the div for the tooltip
      var div = d3.select("body").append("div")	
	  .attr("class", "tooltip")				
	  .style("opacity", 0);
      
      // Add dots
      svg.append('g')
	  .selectAll("dot")
	  .data(data)
	  .enter()
	  .append("circle")
	  .attr("cx", function (d) { return x(d.expenditure); } )
	  .attr("cy", function (d) { return y(d.mr_infant); } )
	  .attr("r", 1.5)
	  .attr("fill", function (d) { return color(d.income); } )
	  .on("mouseover", function(e,d) {
	      console.log(d)
              div.transition()		
                  .duration(200)		
                  .style("opacity", .9);		
              div.html(d.name + "<br/>"  + d.mr_infant)	
                  .style("left", (200) + "px")		
                  .style("top", (200) + "px");	
          })					
          .on("mouseout", function(e,d) {		
              div.transition()		
                  .duration(500)		
                  .style("opacity", 0);	
	  });
  };
  async function init_mat() {
      // Clear old scenes
      d3.selectAll('svg').remove();
      
      // set the dimensions and margins of the graph
      var margin = {top: 10, right: 30, bottom: 30, left: 60},
	  width = 460 - margin.left - margin.right,
	  height = 400 - margin.top - margin.bottom;
      
      // append the svg object to the body of the page
      var svg = d3.select("#slide")
	  .append("svg")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	  .append("g")
          .attr("style", "outline: thin solid red;")
	  .attr("transform",
		"translate(" + margin.left + "," + margin.top + ")");
      
      //Read the data
      var raw_data = await d3.csv("https://raw.githubusercontent.com/AGraci/agraci.github.io/main/cleaned_data_2019.csv");
      var data = raw_data.filter(d => d.expenditure != null && d.mr_mat_2017 != null && d.expenditure != '' && d.mr_mat_2017 != '');
      var data = data.filter(d => d.income != null && d.income != '');
      const xdata = data.map(d => d.expenditure);
      const ydata = data.map(d => d.mr_mat_2017);
      const xextent = d3.extent(xdata)
      const yextent = [Math.min(...ydata), Math.max(...ydata)]
      console.log(xextent)
      console.log(yextent)
      console.log(ydata)
      
      // Add X axis
      var x = d3.scaleLinear()
	  .domain([0, 12000])
	  .range([ 0, width ]);
      svg.append("g")
	  .attr("transform", "translate(0," + height + ")")
	  .call(d3.axisBottom(x));
      
      // Add Y axis
      var y = d3.scaleLinear()
	  .domain([0, Math.max(...ydata)])
	  .range([ height, 0]);
      svg.append("g")
	  .call(d3.axisLeft(y));

      // Add color scale
      const incomes = data.map(d => d.income);
      console.log(d3.extent(incomes))
      console.log(incomes)
      const color = d3.scaleOrdinal()
	    .domain(incomes)
	    .range(d3.schemeSet1)

      // Define the div for the tooltip
      var div = d3.select("body").append("div")	
	  .attr("class", "tooltip")				
	  .style("opacity", 0);
      
      // Add dots
      svg.append('g')
	  .selectAll("dot")
	  .data(data)
	  .enter()
	  .append("circle")
	  .attr("cx", function (d) { return x(d.expenditure); } )
	  .attr("cy", function (d) { return y(d.mr_mat_2017); } )
	  .attr("r", 1.5)
	  .attr("fill", function (d) { return color(d.income); } )
	  .on("mouseover", function(e,d) {
	      console.log(d)
              div.transition()		
                  .duration(200)		
                  .style("opacity", .9);		
              div.html(d.name + "<br/>"  + d.mr_mat_2017)	
                  .style("left", (200) + "px")		
                  .style("top", (200) + "px");	
          })					
          .on("mouseout", function(e,d) {		
              div.transition()		
                  .duration(500)		
                  .style("opacity", 0);	
	  });
  };  
  </script>
</body>
</html>
